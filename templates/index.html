{% extends 'base.html' %}

{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container py-4">
    
    <div class="text-center mb-5">
        {% if nome %}
            <h1 class="display-5">OlÃ¡, <span class="text-primary">{{ nome }}</span>!</h1>
            <p class="text-muted">Aqui estÃ¡ o resumo da sua biblioteca hoje.</p>
        {% else %}
            <h1 class="display-4">BookKeeper</h1>
            <p class="lead">FaÃ§a login para ver seus grÃ¡ficos.</p>
            <a href="/login" class="btn btn-primary mt-3">Entrar agora</a>
        {% endif %}
    </div>

    {% if nome %}
    <div class="row align-items-center">
        
        <div class="col-md-5">
            
            <div class="card bg-dark border-secondary mb-2">
                <div class="card-body py-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted mb-0">Total de Livros</h6>
                        <h3 class="text-white fw-bold mb-0">{% if total is defined %}{{ total }}{% else %}0{% endif %}</h3>
                    </div>
                    <div class="fs-2 text-primary">ðŸ“š</div>
                </div>
            </div>

            <div class="card bg-dark border-secondary mb-2">
                <div class="card-body py-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted mb-0">DisponÃ­veis</h6>
                        <h3 class="text-success fw-bold mb-0">{% if disponiveis is defined %}{{ disponiveis }}{% else %}0{% endif %}</h3>
                    </div>
                    <div class="fs-2 text-success">âœ…</div>
                </div>
            </div>

            <div class="card bg-dark border-secondary mb-2">
                <div class="card-body py-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted mb-0">Lendo Agora</h6>
                        <h3 class="text-info fw-bold mb-0">{% if lendo is defined %}{{ lendo }}{% else %}0{% endif %}</h3>
                    </div>
                    <div class="fs-2 text-info">ðŸ“–</div>
                </div>
            </div>

            <div class="card bg-dark border-secondary mb-2">
                <div class="card-body py-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted mb-0">Emprestados</h6>
                        <h3 class="text-warning fw-bold mb-0">{% if emprestados is defined %}{{ emprestados }}{% else %}0{% endif %}</h3>
                    </div>
                    <div class="fs-2 text-warning">ðŸ‘‹</div>
                </div>
            </div>

        </div>

        <div class="col-md-7">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-header border-secondary text-white">
                    DistribuiÃ§Ã£o do Acervo
                </div>
                <div class="card-body d-flex justify-content-center align-items-center">
                    <div style="width: 100%; max-width: 350px;">
                        <canvas id="graficoLivros"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
    {% endif %}

</div>

{% if nome %}
<script>
    const ctx = document.getElementById('graficoLivros').getContext('2d');

    // Pegando os 3 dados do Python
    const totalDisponiveis = {{ disponiveis if disponiveis is defined else 0 }};
    const totalEmprestados = {{ emprestados if emprestados is defined else 0 }};
    const totalLendo = {{ lendo if lendo is defined else 0 }}; // <-- VariÃ¡vel Nova

    // Verificando se tudo estÃ¡ zerado
    const estaVazio = (totalDisponiveis === 0 && totalEmprestados === 0 && totalLendo === 0);

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            // Legendas incluem "Lendo"
            labels: estaVazio ? ['Sem livros'] : ['DisponÃ­veis', 'Emprestados', 'Lendo'],
            datasets: [{
                // Dados incluem "Lendo"
                data: estaVazio ? [1] : [totalDisponiveis, totalEmprestados, totalLendo],
                backgroundColor: estaVazio 
                    ? ['#6c757d'] 
                    : ['#198754', '#ffc107', '#0dcaf0'], // Verde, Amarelo e AZUL CIANO
                borderColor: '#212529',
                borderWidth: 2,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right', 
                    labels: { color: '#ffffff', font: { size: 12 } }
                }
            }
        }
    });
</script>
{% endif %}

{% endblock %}